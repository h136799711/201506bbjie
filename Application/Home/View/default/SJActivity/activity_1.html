<extend name="template/base_index" />

<block name="area_header">
	<link rel="stylesheet" href="__CSS__/shangjia.css">
	<link rel="stylesheet" href="__CSS__/ystep.css">
	<link type="text/css" rel="stylesheet" href="__CDN__/select2/4.0.0/css/select2.min.css" />
	<style type="text/css">
	.select2-dropdown--below{
		background: white;
	}
	
	.select2-results__options{
		background: white;
	}
		.select2-search--dropdown{
			margin-top: -85px;
			background: white;
		}
	</style>
	<script type="text/javascript" src="__CDN__/select2/4.0.0/js/select2.full.js"></script>
	<script type="text/javascript" src="__CDN__/select2/4.0.0/js/i18n/zh-CN.js"></script>
</block>

<block name="area_body">
	<include file='Widget/sjtop' />
	<div class="seller_main clearfix" controller="seller/common">
		<div class="seller_content_wrap">
			<div class="seller_content" style="padding-top: 10px;">

				<div class="content">
					<h1>创建任务</h1>

					<div class="row">
						<div class="span10">

							<div class="ystep4"></div>

							<!-- 引入jquery -->

							<!-- 引入ystep插件 -->
							<script src="__JS__/ystep.js"></script>
							<script>
								 //根据jQuery选择器找到需要加载ystep的容器
								$(".ystep4").loadStep({
									size: "large",
									color: "blue",
									steps: [{
										title: "创建淘宝任务",
										content: "获取淘宝链接"
									}, {
										title: "设置任务详细信息",
										content: "详细设置"
									}, {
										title: "设置任务订单信息",
										content: "设置订单及聊天信息"
									}, {
										title: "完成",
										content: "创建完成"
									}]
								});
								$(".ystep4").setStep(1);
							</script>
							<div id="taobao" style="padding-top: 50px;">
								商品链接：
								<input id="url" name="url" style="border-bottom-left-radius:5px ;border-top-left-radius:5px ;border: 1px solid #ccc;" />
											<input type="button" id="read" style="color:#666; border-bottom-right-radius:5px ;border-top-right-radius:5px ; border: 1px solid #ccc;" value="从淘宝读取信息" />
								<button id="probtn" type="button" class="am-btn am-btn-default am-round">从商品库中选取</button>
								<br />
								<!--<div class="show"></div>-->
							</div>
							<div id="products" class="filter-controls pull-left">
							<form action="" class="addToGroupForm" method="post">
								<input type="hidden" name="groupid" value="{$groupid}" />
								<select style="width:220px;padding: 10px 15px;font-size: 12px;line-height: 1.42857143;" id="user_select2" name="uid" class="form-control">
									 <option></option>
								</select>
								<button id="taobaobtn" style="margin-left: 250px; margin-top: -80px;" type="button" class="am-btn am-btn-default am-round">从商品库中选取</button>
							</form>
						</div>
							<table class="am-table" style="margin-top: 20px;">
								<thead>
									<tr style="background: #EAEAEA;">
										<th>宝贝图片</th>
										<th>宝贝名称</th>
										<th>商品规格</th>
										<th>商品价格</th>
										<th>件数</th>
										<th>操作</th>
									</tr>
								</thead>
								<tbody>
									<tr >
										<td class="img"></td>
										<td class="title"></td>
										<td class="guige"></td>
										<td class="price"></td>
										<td class="num"></td>
										<td class="xxx"></td>
									</tr>
									<tr >
										<td class="img1"></td>
										<td class="title1"></td>
										<td class="guige1"></td>
										<td class="price1"></td>
										<td class="num1"></td>
										<td class="xxx1"></td>
									</tr>
									<tr >
										<td class="img2"></td>
										<td class="title2"></td>
										<td class="guige2"></td>
										<td class="price2"></td>
										<td class="num2"></td>
										<td class="xxx2"></td>
									</tr>
								</tbody>
							</table>
							<center>
								<font size="-2" color="red">任务最多可以添加3个链接</font>
								<br />
								<button id="down" type="button" class="am-btn am-btn-secondary" style="margin-top: 5px;">下一步</button>
							</center>
						</div>

					</div>
				</div>
			</div>
		</div>
		<include file='Widget/sjleft' />
	</div>
</block>

<block name="area_footer">
	<script type="text/javascript">
	function showLoading() {
	$("#J_btn_submit").text("正在提交中....");
	$("#J_btn_submit").data("query", 1);
	}
		$(function() {
			$('#products').hide();
			$('#probtn').click(function() {
				$('#taobao').hide();
				$('#products').css('margin-left', '200px');
				$('#products').css('margin-top', '50px');
				$('#products').show();
			})
			$('#taobaobtn').click(function() {
				$('#products').hide();
				$('#taobao').show();
			})
			$('#down').click(function() {
				window.location.href = "{:U('Home/SJActivity/activity_2')}";
			})
			$("#groups").change(function() {
				$(".groupForm").submit();
			});
			/*
			 ajax添加select
			 * */
			
			/*
			 从淘宝获取数据
			 * */
			$("#read").click(function() {
			var query = $("#J_btn_submit").data("query");
			if (query == 1) {
				alert("正在请求中...");
				return;
			}
			var param_url = $("#url").val();
			$.ajax({
				cache: false,
				method: "post",
				url: "{:U('Home/SJActivity/read',array('r'=>time()))}",
				data: {
					url: encodeURI(param_url)
				},
				dataType: "json",
				beforeSend: function() {
					showLoading();
				}
			}).done(function(data) {
				$("#read").html("提交");
				$("#read").data("query", 0);
				console.log(data);
				if (data.status) {
					var title =  data.info.title;
					var wangwang = data.info.wangwang;
					if($(".title").text()==''){
						$(".img").html("<img src='" + data.info.main_img + "' alt='图片' style='height:50px;width:100px;folat:left;'  />");
						$(".title").text(title);
						$(".guige").text('无');
						$(".num").html("<input type='text' style='width:50px' name='num'>");
						$(".xxx").html("<button class='am-btn am-btn-primary am-btn-xs' style='height:20px'>×</button>");
						$('.price').html("<input type='text' style='width:50px' name='price'>");
//						$(".show").html("<img  src='" + data.info.main_img + "' alt='图片' style='float:left' />" + title);
					}else if($(".title").text()!='' && $(".title1").text()==''){
						$(".img1").html("<img src='" + data.info.main_img + "' alt='图片' style='height:50px;width:100px;folat:left;'  />");
						$(".title1").text(title);
						$(".guige1").text('无');
						$(".num1").html("<input type='text' style='width:50px' name='num'>");
						$(".xxx1").html("<button class='am-btn am-btn-primary am-btn-xs' style='height:20px'>×</button>");
						$('.price1').html("<input type='text' style='width:50px' name='price'>");
					}else if($(".title").text()!='' && $(".title1").text()!=''){
						$(".img2").html("<img src='" + data.info.main_img + "' alt='图片' style='height:50px;width:100px;folat:left;'  />");
						$(".title2").text(title);
						$(".guige2").text('无');
						$(".num2").html("<input type='text' style='width:50px' name='num'>");
						$(".xxx2").html("<button class='am-btn am-btn-primary am-btn-xs' style='height:20px'>×</button>");
						$('.price2').html("<input type='text' style='width:50px' name='price'>");
					}
					
						
						
//					} else {
//						$('#doc-modal-1 .am-modal-dialog').css('height', '580px');
//						$(".show").html("<font color='red'>该商品的铺主为：" + wangwang + "</font><br><font color='red'>请录入您自己的商品</font>");
//					}
				} else {
					$('#doc-modal-1 .am-modal-dialog').css('height', '520px');
					$(".show").html("<font color='red'>" + data.info + "</font>");
					//							alert(data.)
				}
			})
		})
			/*
			 清空单个记录
			 * */
		$(".xxx").click(function(){
			$(".img").empty();
			$(".title").empty();
			$(".guige").empty();
			$(".num").empty();
			$(".xxx").empty();
			$('.price').empty();
		})
		$(".xxx1").click(function(){
			$(".img").empty();
			$(".title").empty();
			$(".guige").empty();
			$(".num").empty();
			$(".xxx").empty();
			$('.price').empty();
		})
		$(".xxx2").click(function(){
			$(".img").empty();
			$(".title").empty();
			$(".guige").empty();
			$(".num").empty();
			$(".xxx").empty();
			$('.price').empty();
		})
		
		$("#user_select2").select2({
			placeholder: "输入宝贝名称"	,
			language: "zh-CN",
			ajax: {
			    url: "{:U('Home/SJActivity/select')}",
			    dataType: 'json',
			    delay: 250,
			    data: function (params) {
			    	var queryParameters = {
				      q: params.term
				    }
    				return queryParameters;
			      
			    },
			    processResults: function (data, page) {
			    	if(!data.info){
			    		data.info = new Array();
			    		data.info['nodata']="无相关数据";
			    	}
			      	// parse the results into the format expected by Select2.
			      	// since we are using custom formatting functions we do not need to
			      	// alter the remote JSON data
			      	return {
			        	results: data.info
			      	};
			    },
			    cache: true
		  	}, 
			  	minimumInputLength: 0,
				templateSelection: function (repo) {	
	  				return repo.title || repo.text;
				},
			  templateResult: function (repo) {
			   		
      				if (repo.loading) return repo.text;
					if(repo.nodata) return repo.nodata;
//    				var markup = '<div>'+repo.nickname+'</div>';
      				var markup = '<div><img src="'+repo.main_img+'" style="width:30px;height:30px;"/> '+repo.title+'</div>';
      				return markup;
    			},
		});
		})
	</script>
</block>