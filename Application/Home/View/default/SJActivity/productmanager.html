<extend name="template/base_index" />
<block name="area_header">
    <link rel="stylesheet" href="__CSS__/shangjia2.css">
	<style type="text/css">.show img {
	width: 80px;
	height: 80px;
	margin-right: 5px;
}
.show {
	padding: 10px;
	width: 80%;
	font-size: 12px;
}
    .product_info{
        background: #DEDEDE;
    }
    .j_update_modal .am-modal-bd,
    #doc-modal-1 .am-modal-bd{
            height: 380px;
            overflow: scroll;
            overflow-x:hidden;
        }
    </style>
</block>
<block name="area_body">
	<include file='Widget/sjtop' />
	<div class="seller_main clearfix" >
		<div class="seller_content_wrap">
			<div class="seller_content" style="padding-top: 10px;">
				<div class="content">


					<!--录入商品窗口-->
					<div class="am-modal am-modal-no-btn" tabindex="-1" id="doc-modal-1">
						<div class="am-modal-dialog" style="border-radius: 5px;">
							<div class="am-modal-hd" style="border-bottom: 1px solid #ccc; text-align: left;font-size:18px;">
								添加任务商品
								<a href="javascript: void(0)" class="am-close am-close-spin" data-am-modal-close>
									&times;
								</a>
							</div>
							<div class="am-modal-bd">
								<form class="fms"  method="post">
                                    <input type="hidden" class="j_main_img" name="main_img" />
                                    <input type="hidden" class="j_title" name="title" />
                                    <input type="hidden" class="j_code" name="code" />
								<table  style="margin-top: 10px;">
									<tr>
										<td width="20%" style="text-align: right; padding-right: 5px; padding-top: 10px;">
											商品链接
										</td>
										<td style="padding-top: 10px;">
											<input id="url" name="url" style="width:320px;border-bottom-left-radius:5px ;border-top-left-radius:5px ;border: 1px solid #ccc;" />
											<input type="button" id="read" style="color:#666; border-bottom-right-radius:5px ;border-top-right-radius:5px ; border: 1px solid #ccc;" value="从淘宝读取信息" />
										</td>
									</tr>
									<tr>
										<td style="text-align: right;padding-right: 5px;padding-top: 10px;">
										</td>
										<td style="font-size: 12px;padding-top: 10px;">
											供客服审核使用,不会展示给试民
										</td>
									</tr>

									<tr>
										<td style="text-align: right;padding-right: 5px;padding-top: 10px;">
										</td>
										<td class="product_info">
                                            <div class="j_error" ></div>
											<div class="j_show" style="display: none;">
                                                <div style="width:150px;height:150px;" class="am-fl"><img src="" class="j_main_img am-img-responsive"/></div>
                                                <div style="margin-left:155px;" class="am-padding-sm">
                                                    <p>标题: <span class="j_title"></span></p>
                                                    <p>货号或款号: <span class="j_code"></span></p>
                                                    <p class="am-text-success">获取信息成功</p>
                                                </div>
											</div>
										</td>
									</tr>

									<tr>
										<td style="text-align: right;padding-right: 5px;padding-top: 10px;">
											价格*
										</td>
										<td style="padding-top: 10px;">
											<input name="price" style="border-bottom-left-radius:5px ;border-top-left-radius:5px ;border: 1px solid #ccc;" />
											<input type="button" name="price" value="元" disabled="disabled" style="border-bottom-right-radius:5px ;border-top-right-radius:5px ;border: 1px solid #ccc;" />
										</td>
									</tr>
									<tr>
										<td style="padding-top: 10px;">
										</td>
										<td style="font-size: 12px;padding-top: 10px;">
											我的商品有较大的价格跨度?我想更精准的分配任务？
											<a id="gaoji" href="javascript:void(0)">
												点此进入高级设置
											</a>
										</td>
									</tr>
									<tr>
										<td style="padding-top: 10px;">
										</td>
										<td style="font-size: 12px;padding-top: 10px;">
											<div class="hid">
												型号ID：1&nbsp;&nbsp;&nbsp;&nbsp;
												商品型号 ：<input type="text" name="xinghao1" placeholder="试民自己选择" value="">
												商品价格：<input type="text" name="price1" value="0.00"/><br>
												型号ID：2&nbsp;&nbsp;&nbsp;&nbsp;
												商品型号 ：<input type="text" name="xinghao2" placeholder="试民自己选择">
												商品价格：<input type="text" name="price2" value="0.00"/><br>
												型号ID：3&nbsp;&nbsp;&nbsp;&nbsp;
												商品型号 ：<input type="text" name="xinghao3" placeholder="试民自己选择">
												商品价格：<input type="text" name="price3" value="0.00"/><br>
											</div>
										</td>
									</tr>
									<tr>
										<td style="text-align: right;padding-right: 5px; vertical-align: top;padding-top: 10px;">
											商品位置
										</td>
										
										<td style="padding-top: 10px;">
											<textarea rows="5" cols="70" name="weizhi"></textarea>																						
												<br>
												试民要根据此信息在店铺中找到商品,审核后可修改
												<br>
												例子:首页-所有宝贝-T恤-第2页
										</td>
									</tr>
									<tr>
										<td style="padding-top: 10px;">
										</td>
										<td style="padding-top: 10px;">
											<a  href="{:U('Home/SJActivity/addproduct')}" target-form="fms" class="ajax-post am-btn am-btn-primary am-btn-xs" style="width: 80px; height:30px;padding: 5px;border-radius: 5px; ">
												保存
											</a>
										</td>
									</tr>
								</table>
								</form>
							</div>
						</div>
					</div>
					<!--录入商品窗口-->
					
					
					<!--更新商品窗口-->
					<div style="WIDTH: 680PX;" class="am-modal j_update_modal am-modal-no-btn" tabindex="-1" id="doc-modal-2">
						<div class="am-modal-dialog" style="border-radius: 5px;">
							<div class="am-modal-hd" style="border-bottom: 1px solid #ccc; text-align: left;font-size:18px;">
								更新任务商品
								<a href="javascript: void(0)" class="am-close am-close-spin" data-am-modal-close>
									&times;
								</a>
							</div>
							<div class="am-modal-bd">
								<form action="{:U('Home/SJActivity/productedit')}" class="gxfm" method="get">
								    <input type="hidden" name="id" id="product_id" value="{$product.id}" />
                                    <input type="hidden" class="j_main_img" name="main_img" />
                                    <input type="hidden" class="j_title" name="title" />
                                    <input type="hidden" class="j_code" name="code" />

								<table border="" cellspacing="" cellpadding="" style="margin-top: 10px;">
									
									<tr>
										<td width="20%" style="text-align: right; padding-right: 5px; padding-top: 10px;">
											商品链接
										</td>
										<td style="padding-top: 10px;">
                                            <p class="product_link">{$product.link}</p>
										</td>
									</tr>
									<tr>
										<td style="text-align: right;padding-right: 5px;padding-top: 10px;">
										</td>
										<td style="font-size: 12px;padding-top: 10px;">
											供客服审核使用,不会展示给试民
										</td>
									</tr>
									<tr>
										<td style="text-align: right;padding-right: 5px;padding-top: 10px;">
										</td>
										<td style="font-size: 12px;padding-top: 10px;">
											<div class="show1" style="text-align: left;">
												<div class="am-fl" style=" height: 100px; width: 100px;">
                                                    <img class="am-img-responsive" src="{$product['main_img']}">
                                                </div>

                                                <div class="am-pading-sm " style="margin-left:110px;">
                                                    <p class="am-padding-left-sm">标题:<span class="j_title">{$product.title}</span> </p>
                                                    <p class="am-padding-left-sm">货号或款号: <span class="j_code">{$product.p_code}</span></p>

                                                    <p class="am-padding-left-sm am-text-success">
                                                       <a class="am-btn am-btn-sm am-btn-default j_update_info"  href="javascript:void(0)">更新信息</a>
                                                    </p>
                                                </div>
                                            </div>
										</td>
									</tr>
									<tr>
										<td style="text-align: right;padding-right: 5px;padding-top: 10px;">
											价格*
										</td>
										<td style="padding-top: 10px;">
											<input name="price" value="{$product['price']}" style="border-bottom-left-radius:5px ;border-top-left-radius:5px ;border: 1px solid #ccc;" />
										元</td>
									</tr>
									
									<tr>
										<td style="text-align: right;padding-right: 5px; vertical-align: top;padding-top: 10px;">
											商品位置
										</td>
										
										<td style="padding-top: 10px;">
											<textarea rows="5" cols="70" name="weizhi">{$product['position']}</textarea>																						
												<br>
											<font size="-1">
												试民要根据此信息在店铺中找到商品,审核后可修改
												<br>
												<font size="-2">
													例子:首页-所有宝贝-T恤-第2页
												</font>
											</font>
										</td>
									</tr>
									<tr>
										<td style="padding-top: 10px;">
										</td>
										<td style="padding-top: 10px;">
											<button type="button" url="{:U('Home/SJActivity/productedit')}" target-form="gxfm" class="ajax-post am-btn am-btn-primary am-btn-xs" style="width: 80px; height:30px;padding: 0;border-radius: 5px; ">
												保存
											</button>
										</td>
									</tr>
									
								</table>
								</form>
							</div>
						</div>
					</div>
					<!--更新商品窗口-->

					<h1 style="height: 40px;">
						<div class="pull-right btn-group">
							<button id="luruBtn" class="am-btn am-btn-primary am-btn-xs" style="height: 30px;width: 70px; font-size: 12px; padding: 0;border-radius: 5px;" data-am-modal="{target: '#doc-modal-1', closeViaDimmer: 0, width: 750, height:500}">
								录入商品
							</button>
						</div>
						<div class="pull-left">
							商品管理
						</div>
					</h1>
					<div >
						<ul id="ul_start_down" class="nav nav-tabs" role="menu">
							<li <eq name="sale" value="1">class="active" </eq> role="menuitem">
								<a tabindex="-1" href="{:U('Home/SJActivity/productmanager')}">
									启用状态商品
								</a>
							</li>
							<li <eq name="sale" value="0">class="active" </eq>  role="menuitem">
								<a tabindex="-1" href="{:U('Home/SJActivity/productmanager',array('sale'=>0))}">
									已下架
								</a>
							</li>
						</ul>

						<form action="{:U('Home/SJActivity/productmanager')}" method="post" class="search_form-processed">
							<div class="well well-small">
								<div class="row">
									<div class="span4">
										按名称
										<input placeholder="搜索宝贝名称" class="mb0" VALUE="{$name}" name="name" id="Product_title" type="text" style="height: 30px;">
									</div>
									<!--<div class="span4">-->
										<!--按宝贝链接-->
										<!--<input placeholder="输入宝贝链接搜索" class="mb0" autocomplete="off" onclick="this.select()" name="url" style="height: 30px;" id="Product_url" type="text">-->
									<!--</div>-->
									<div class="span2">
										<button class="btn" type="submit" name="yt0">
											搜索
										</button>
									</div>
								</div>
							</div>
						</form>
						<div>
							<!-- 上架中-->
							<div class="grid-view" >
								<table class="items table table-hover">
									<thead>
										<tr>
											<th width="40" id="product-grid_c0">
												<a class="sort-link" href="#">
													ID
													<span class="caret">
													</span>
												</a>
											</th>
											<th id="product-grid_c1">
												宝贝名称
											</th>
											<th width="80" id="product-grid_c2">
												<a class="sort-link">
													单价
													<span class="caret">
													</span>
												</a>
											</th>
											<th width="220" id="product-grid_c3">
												<a class="sort-link" >
													位置
													<span class="caret">
													</span>
												</a>
											</th>
											<th width="160" id="product-grid_c5">
												<a class="sort-link desc" >
													最后更新
													<span class="caret">
													</span>
												</a>
											</th>
											<th width="60" id="product-grid_c6">
												操作
											</th>
										</tr>
									</thead>
									<tbody>
										<empty name="products">
											<tr><td colspan="6">暂无商品信息</td></tr>
										<else/>
										<volist name="products" id="vo">
										<tr class="odd">
											<td>
												{$vo.id}
											</td>
											<td>
												<a data-toggle="modal2"  href="#">
													<div class="p_img">
														<img width="56px" height="56px" src="{$vo.main_img}" alt="">
													</div>
													<div class="p_title small">
														{$vo.title}
														<br>
														<span class="muted">
                                                            {$vo.p_code}
														</span>
													</div>
												</a>
											</td>
											<td>
												<span  >{$vo.price}</span>
											</td>
											<td>
												<span >{$vo.position}</span>
											</td>
											<td>
												<span title="{$vo.update_time|date='Y-m-d H:i:s',###}">
                                                    {$vo.update_time|date='Y-m-d H:i:s',###}
                                                </span>
											</td>
											<td>
												<a  class="btn btn-mini am-margin-bottom-sm" href="{:U('Home/SJActivity/productmanager',array('sale'=>$vo['is_on_sale'],'id'=>$vo['id']))}" >
													更新
												</a>
                                                <BR/>
                                                <BR/>
                                                <eq name="vo['is_on_sale']" value="1">
												<a  class="ajax-post btn btn-mini"
												href="{:U('Home/SJActivity/on_sale',array('sale'=>0,'id'=>$vo['id']))}" target-form="">
													下架
												</a>
                                                    <else/>
                                                    <a  class="ajax-post btn btn-mini"
                                                        href="{:U('Home/SJActivity/on_sale',array('sale'=>1,'id'=>$vo['id']))}" target-form="">
                                                        上架
                                                    </a>
                                                </eq>
											</td>
										</tr>
										</volist>
										</empty>
									</tbody>
								</table>

								<!-- 上架中-->
								
								<div class="row-fluid">
									<div class="span6 offset3">
									</div>
									<div class="span3">
										<div class="summary">
											{$show}
										</div>
									</div>
								</div>
							</div>

						</div>
					</div>
				</div>
			</div>
		</div>												
		<include file='Widget/sjleft' />
	</div>
</block>
<block name="area_footer">
<script type="text/javascript">
    function showLoading() {
	$("#J_btn_submit").text("正在提交中....");
	$("#J_btn_submit").data("query", 1);
	}
	$(function() {


		
		$('.hid').hide();
		
		$('#gaoji').click(function(){
			
			$('.hid').toggle(function(){
				$('#doc-modal-1 .am-modal-dialog').css('height','640px');
			});
		})

        if($("#product_id").val() != ''){
            $('#doc-modal-2').modal();
        }
        $(".j_update_info").click(function(){
            var url = "{$product.link}";
            $.ajax({
                cache: false,
                method: "post",
                type: "post",
                dataType: 'jsonp',
                jsonp: 'jsonp',
                url: "{:U('Tool/RemoteProductParser/read',array('r'=>time()))}",
                data: {
                    url: encodeURI(url)
                },

                beforeSend: function() {
                    $(".j_update_info").text("正在获取中...");
                }
            }).done(function(data) {
                $(".j_update_info").text("更新信息");
                alert("更新成功");
                if (data.status) {
                    var title = data.info.title;
                    var wangwang = data.info.wangwang;
                    var code = data.info.code;

                    $(".product_info .j_error").hide();
                    $(".product_info .j_show").show();

                    $("input.j_title").val(title);
                    $("input.j_main_img").val(data.info.main_img);
                    $("input.j_code").val(code);
                    $(".j_update_modal img.j_main_img").attr('src', data.info.main_img);
                    $(".j_update_modal span.j_title").text(title);
                    $(".j_update_modal span.j_code").text(code);

                }
            });
        })
		$("#read").click(function() {
            var str  =  $("#url").val();
            var index = str.indexOf("id=");
            var sub_str = str.substr(index,str.length-index);
            var arr_str =  sub_str.split("&");
            var domain_str = str.split("?");
            var url = domain_str[0] + "?" + arr_str[0];
            $("#url").val(url);
			$.getJSON("{:U('Home/SJActivity/checkurl')}",{url:url},function(json){
				if(json == 0){
					alert('已经添加过该商品,无需重复添加!');
				}else{
					var query = $("#J_btn_submit").data("query");
					if (query == 1) {
						alert("正在请求中...");
						return;
					}
					var param_url = $("#url").val();
					$.ajax({
						cache: false,
						method: "post",
                        type: "post",
                        dataType: 'jsonp',
                        jsonp: 'jsonp',
                        url: "{:U('Tool/RemoteProductParser/read',array('r'=>time()))}",
//                        url: "http://bbj.itboye.com/index.php/Tool/RemoteProductParser/read",
						data: {
							url: encodeURI(param_url)
						},
//						dataType: "json",
						beforeSend: function() {
							showLoading();
						}
					}).done(function(data) {
						$("#read").text("提交");
						$("#read").data("query", 0);
						console.log(data);

						if (data.status) {
							var title =  data.info.title;
                            var wangwang = data.info.wangwang;
                            var code = data.info.code;
							if ('{$user.aliwawa}'.trim() == wangwang.trim()) {
                                $(".product_info .j_error").hide();
                                $(".product_info .j_show").show();
								$("input[name='alww']").val(wangwang.trim());
								$("input.j_title").val(title);
                                $("input.j_main_img").val(data.info.main_img);
                                $("input.j_code").val(code);
//								$('#doc-modal-1 .am-modal-dialog').css('height', '600px');
								$(".j_show .j_main_img").attr('src',data.info.main_img);
                                $(".j_show .j_title").text(title);
                                $(".j_show .j_code").text(code);
							} else {
                                $(".product_info .j_error").show();
                                $(".product_info .j_show").hide();
//								$('#doc-modal-1 .am-modal-dialog').css('height', '580px');

                                $(".product_info .j_error").html("<font color='red'>该商品的铺主为：" + wangwang + "</font><br>" +
                                "<font color='red'>您的阿里旺旺为：" + '{$user.aliwawa}' + "</font>" +
                                "<br><font color='red'>请录入您自己的商品</font>");


                            }
						} else {
//							$('#doc-modal-1 .am-modal-dialog').css('height', '520px');
							$(".show").html("<font color='red'>" + data.info + "</font>");
							//							alert(data.)
						}
					})
				}
			});

		});
		var d=0;
		/*更新*/
		$("#read1").click(function() {
			
			var query = $("#J_btn_submit").data("query");
			if (query == 1) {
				alert("正在请求中...");
				return;
			}
			var param_url = $("#url1").val();
			$.ajax({
				cache: false,
				method: "post",
				url: "{:U('Tool/RemoteProductParser/read',array('r'=>time()))}",
				data: {
					url: encodeURI(param_url)
				},
				dataType: "json",
				beforeSend: function() {
					showLoading();
				}
			}).done(function(data) {
				$("#read1").text("提交");
				$("#read1").data("query", 0);
				console.log(data);
				if (data.status) {
					var title =  (data.info.title).substring(14,50);
					var wangwang = data.info.wangwang;
					if ('{$user.aliwawa}'.trim() == wangwang.trim()) {
						$("input[name='alww']").val(wangwang.trim());
						$(".title1").val(title);
						$(".img1").val(data.info.main_img);
//						$('#doc-modal-2 .am-modal-dialog').css('height', '600px');
						$(".show1").html("<img height='150' width='150'  src='" + data.info.main_img + "' alt='图片' style='float:left' /><br><button id='read1' type='button' class='am-btn-default'>更新商品</button>" + title);
						
					} else {
//						$('#doc-modal-2 .am-modal-dialog').css('height', '580px');
						$(".show1").html("<font color='red'>该商品的铺主为：" + wangwang + "</font><br><font color='red'>您的阿里旺旺为：" + '{$user.aliwawa}' + "</font><br><font color='red'>请录入您自己的商品</font>");
					}
				} else {
//					$('#doc-modal-2 .am-modal-dialog').css('height', '520px');
					$(".show").html("<font color='red'>" + data.info + "</font>");
					//							alert(data.)
				}
			})
		})
})</script>
</block>
